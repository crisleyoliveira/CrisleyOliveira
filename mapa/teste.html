<!DOCTYPE html>
<html lang='en'>
<head>
    <!-- META -->
    <meta charset='utf-8' />
    <meta name='viewport' content='initial-scale=1, maximum-scale=1, user-scalable=no' />
    <meta name="format-detection" content="telephone=no">

    <!-- TITLE -->
    <title>Lisboa</title>

    <!-- STYLE SHEETS -->
    <link href='https://fonts.googleapis.com/css?family=Space+Grotesk:300,400,600' rel='stylesheet'>
    <link rel='stylesheet' href='style.css' type='text/css' />
    <link rel='stylesheet' href='d3.slider.css' type='text/css' />

    <!-- MapBox GL JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css' rel='stylesheet' />

    <!-- Three.js -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'></script>
</head>
<body>
    <!-- HEADER -->
    <div id='header'>
        <!-- HEADER/TITLE -->
        <div id='title'>
            <span class='desktop'>Lisboa&nbsp;Airbnb&nbsp;Explorer</span>
        </div>
    </div>

    <!-- MB Map -->
    <div id='map'></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiY3Jpc2xleW5vIiwiYSI6ImNsanZqc3V5czE3emYzdG4wdnl5emRkOGsifQ.1npueBKtBTbhxx7Wyko1Mw';

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v10',
            center: [-9.1393, 38.7223], // Coordenadas de Lisboa
            zoom: 12,
            pitch: 60, // Ajuste o valor para definir a inclinação 3D adequada
            bearing: 20,
            antialias: true
        });

        // Function to load and process the GeoJSON data
        function loadData() {
            fetch('lisboa.geojson')
                .then(response => response.json())
                .then(data => addCubesToMap(data));
        }

        // Function to add 3D cubes to the map
        function addCubesToMap(data) {
            map.on('load', function () {
                // Create a source to hold the grouped data
                map.addSource('airbnbData', {
                    type: 'geojson',
                    data: data,
                    cluster: true,
                    clusterMaxZoom: 14, // Max zoom to cluster points
                    clusterRadius: 50 // Radius of each cluster when clustering points (in pixels)
                });

                // Create custom Three.js objects for each location
                map.on('render', function () {
                    var cubeGeo = new THREE.BoxGeometry(10, 10, 10);
                    var cubeMat = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                    
                    data.features.forEach(function (feature) {
                        var coordinates = feature.geometry.coordinates;
                        var cube = new THREE.Mesh(cubeGeo, cubeMat);
                        cube.position.set(coordinates[0], coordinates[1], 10); // Add a height of 10 to represent the cube above the map surface
                        map.getCanvasContainer().appendChild(cube);
                    });
                });
            });
        }

        loadData();
    </script>
</body>
</html>
